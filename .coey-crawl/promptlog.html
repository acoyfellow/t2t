<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>">

		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="coey.dev" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin="anonymous"
    />
    <link class="deferred-stylesheet" rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Google+Sans:300,400,500,600,700&family=Google+Sans+Mono:300,400,500,600,700&amp;display=swap&amp;lang=en" as="style">

		
		<link href="./_app/immutable/assets/0.-k1r2YJt.css" rel="stylesheet">
		<link href="./_app/immutable/assets/CodeBlock.mf1IAhYo.css" rel="stylesheet"><!--12qhfyh--><meta name="description" content="Developer thoughts and code"/><!----><!--ojxrft--><meta name="description" content="POC: Dynamic code execution with Cloudflare Worker Loader API, isolated environments, and Durable Object history tracking"/> <meta name="keywords" content="promptlog, worker loader, sandbox, cloudflare"/> <link rel="canonical" href="https://coey.dev/promptlog"/> <meta name="author" content="Jordan Coeyman"/> <!--[!--><!--]--> <meta property="og:title" content="Promptlog: Dynamic Worker Loader with Sandboxed Code Execution"/> <meta property="og:description" content="POC: Dynamic code execution with Cloudflare Worker Loader API, isolated environments, and Durable Object history tracking"/> <meta property="og:type" content="article"/> <meta property="og:url" content="https://coey.dev/promptlog"/> <meta property="og:image" content="https://api.coey.dev/?title=Promptlog%3A%20Dynamic%20Worker%20Loader%20with%20Sandboxed%20Code%20Execution&amp;description=POC%3A%20Dynamic%20code%20execution%20with%20Cloudflare%20Worker%20Loader%20API%2C%20isolated%20environments%2C%20and%20Durable%20Object%20history%20tracking"/> <meta property="og:site_name" content="coey.dev"/> <meta name="twitter:card" content="summary_large_image"/> <meta name="twitter:title" content="Promptlog: Dynamic Worker Loader with Sandboxed Code Execution"/> <meta name="twitter:description" content="POC: Dynamic code execution with Cloudflare Worker Loader API, isolated environments, and Durable Object history tracking"/> <meta name="twitter:image" content="https://api.coey.dev/?title=Promptlog%3A%20Dynamic%20Worker%20Loader%20with%20Sandboxed%20Code%20Execution&amp;description=POC%3A%20Dynamic%20code%20execution%20with%20Cloudflare%20Worker%20Loader%20API%2C%20isolated%20environments%2C%20and%20Durable%20Object%20history%20tracking"/> <meta name="twitter:site" content="@acoyfellow"/> <!--[--><meta property="article:published_time" content="2025-10-14"/> <meta property="article:modified_time" content="2025-10-14"/> <!--[--><meta property="article:section" content="technical"/><!--]--> <!--[--><meta property="article:tag" content="cloudflare,worker-loader,sandbox"/><!--]--><!--]-->  <!----><script type="application/ld+json" nonce="%sveltekit.nonce%">{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Jordan Coeyman",
  "url": "https://coey.dev",
  "logo": {
    "@type": "ImageObject",
    "url": "https://coey.dev/jordan.jpg"
  },
  "sameAs": [
    "https://x.com/acoyfellow",
    "https://github.com/acoyfellow"
  ]
}</script><!----> <!--[!--><!--]--> <!--[--><!----><script type="application/ld+json" nonce="%sveltekit.nonce%">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Promptlog: Dynamic Worker Loader with Sandboxed Code Execution",
  "description": "POC: Dynamic code execution with Cloudflare Worker Loader API, isolated environments, and Durable Object history tracking",
  "image": "https://api.coey.dev/?title=Promptlog%3A%20Dynamic%20Worker%20Loader%20with%20Sandboxed%20Code%20Execution&description=POC%3A%20Dynamic%20code%20execution%20with%20Cloudflare%20Worker%20Loader%20API%2C%20isolated%20environments%2C%20and%20Durable%20Object%20history%20tracking",
  "wordCount": 0,
  "author": {
    "@type": "Organization",
    "name": "Jordan Coeyman"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jordan Coeyman",
    "logo": {
      "@type": "ImageObject",
      "url": "https://coey.dev/jordan.jpg"
    }
  },
  "datePublished": "2025-10-14",
  "dateModified": "2025-10-14",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://coey.dev/promptlog"
  }
}</script><!----><!--]--> <!--[!--><!--]--><!----><title>Promptlog: Dynamic Worker Loader with Sandboxed Code Execution</title>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents"><!--[--><!--[--><!----><header class="flex items-center justify-between p-4 gap-4 flex-wrap" id="nav"><a href="/" class="px-4 py-2 md:px-8 md:py-4 md:text-2xl font-black hover:bg-white hover:text-black border-4 border-black hover:border-white bg-white text-black">coey.dev</a> <nav><div class="flex gap-0"><a href="/" class="px-4 py-2 md:px-8 md:py-4 md:text-2xl font-black hover:bg-white hover:text-black border-4 border-black bg-white text-black">POSTS</a> <a href="/about" class="px-4 py-2 md:px-8 md:py-4 md:text-2xl font-black hover:bg-black hover:text-white border-4 border-black border-l-0 bg-white text-black">ABOUT</a></div></nav></header> <div class="fixed inset-0 pointer-events-none -z-10" style="opacity: 0.7; mix-blend-mode: multiply; will-change: transform;"></div><!----> <main class="pt-20 relative"><!----><!--[--><!--]--> <main class="bg-white text-black"><div class="max-w-4xl mx-auto px-6 py-12"><header class="border-b-2 border-black pb-8 mb-12"><h1 class="text-4xl font-bold uppercase tracking-wider mb-4">PROMPTLOG: DYNAMIC WORKER LOADER POC</h1> <p class="text-xl font-mono">Run user code in sandboxed Workers via Dynamic Worker Loader API</p> <div class="mt-4 font-mono"><span class="bg-black text-white px-2 py-1">CLOUDFLARE WORKERS</span> <span class="ml-4">2025.10.14</span></div> <p class="text-xs font-mono pt-6">View source on <a href="https://github.com/acoyfellow/promptlog" class="underline">GitHub</a></p></header> <section class="mb-12 border-l-2 border-black pl-6"><h2 class="text-2xl font-bold font-mono mb-4">THE CONCEPT</h2> <p class="text-lg leading-relaxed mb-4"><strong>Problem:</strong> How do you safely run user-provided JavaScript in a serverless environment?</p> <p class="leading-relaxed mb-4"><strong>Solution:</strong> Use Cloudflare's Dynamic Worker Loader API to create isolated Workers on-demand. Each piece of user code gets its own sandboxed environment with zero network access.</p> <div class="bg-black text-white p-4 font-mono"><pre>POST /submit â†’ Hash code â†’ Create Worker â†’ Execute safely</pre></div></section></div></main> <section class="p-8"><div class="max-w-4xl mx-auto space-y-10"><div><h2 class="text-2xl font-bold font-mono mb-4">1. WRANGLER CONFIG</h2> <p class="mb-3 font-mono">Enable the Dynamic Worker Loader API in your wrangler.json:</p> <div class="border-2 border-black"><!--[!--><pre class="bg-black border-2 border-black p-4 overflow-x-auto text-white"><code>{
  "name": "promptlog",
  "main": "src/index.ts",
  "compatibility_date": "2024-01-15",
  "experimental": {
    "worker_loader": true
  }
}</code></pre><!--]--><!----></div></div> <div><h2 class="text-2xl font-bold font-mono mb-4">2. MAIN WORKER</h2> <p class="mb-3 font-mono">Accept code, hash it, create a dynamic worker:</p> <div class="border-2 border-black"><!--[!--><pre class="bg-black border-2 border-black p-4 overflow-x-auto text-white"><code>import { Hono } from 'hono';

const app = new Hono();

// Submit user code and get execution hash
app.post('/submit', async (c) => {
  const { code } = await c.req.json();

  // Hash the code to create unique worker ID
  const hash = await hashCode(code);

  // Create dynamic worker from user code
  await createDynamicWorker(hash, code, c.env);

  return c.json({ hash, url: `/run/${hash}` });
});

// Execute the user's code
app.get('/run/:hash', async (c) => {
  const hash = c.req.param('hash');
  const prompt = c.req.query('prompt') || '';

  // Get the dynamic worker and run it
  const worker = c.env.WORKER_LOADER.get(hash);
  const response = await worker.fetch(
    new Request(`https://dummy/?prompt=${encodeURIComponent(prompt)}`)
  );

  return response;
});

async function hashCode(code: string): Promise&lt;string> {
  const encoder = new TextEncoder();
  const data = encoder.encode(code);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').slice(0, 8);
}

export default app;</code></pre><!--]--><!----></div></div> <div><h2 class="text-2xl font-bold font-mono mb-4">3. DYNAMIC WORKER CREATION</h2> <p class="mb-3 font-mono">The core: create isolated workers from user code:</p> <div class="border-2 border-black"><!--[!--><pre class="bg-black border-2 border-black p-4 overflow-x-auto text-white"><code>async function createDynamicWorker(hash: string, userCode: string, env: any) {
  // Wrap user code in a secure worker template
  const workerCode = `
    export default {
      async fetch(request) {
        const url = new URL(request.url);
        const prompt = url.searchParams.get('prompt') || '';

        try {
          // Execute user code
          ${userCode}

          // Return the result
          return new Response(JSON.stringify(result), {
            headers: { 'content-type': 'application/json' }
          });
        } catch (error) {
          return new Response(JSON.stringify({
            error: error.message
          }), {
            status: 500,
            headers: { 'content-type': 'application/json' }
          });
        }
      }
    };
  `;

  // Create the worker with network isolation
  await env.WORKER_LOADER.put(hash, workerCode, {
    globalOutbound: null  // No network access
  });
}</code></pre><!--]--><!----></div></div> <div><h2 class="text-2xl font-bold font-mono mb-4">4. USER CODE EXAMPLE</h2> <p class="mb-3 font-mono">What users can submit (gets wrapped and executed):</p> <div class="border-2 border-black"><!--[!--><pre class="bg-black border-2 border-black p-4 overflow-x-auto text-white"><code>// User submits this JavaScript:

const words = prompt.split(' ');
const reversed = words.reverse().join(' ');

const result = {
  original: prompt,
  reversed: reversed,
  wordCount: words.length,
  timestamp: new Date().toISOString()
};

// The wrapper will return this as JSON</code></pre><!--]--><!----></div></div> <div><h2 class="text-2xl font-bold font-mono mb-4">HOW IT WORKS</h2> <ol class="list-decimal ml-6 space-y-2"><li><strong>Submit code:</strong> POST JavaScript to <code>/submit</code></li> <li><strong>Hash creation:</strong> Generate SHA-256 hash of the code</li> <li><strong>Worker creation:</strong> Use Dynamic Worker Loader to create isolated environment</li> <li><strong>Execute safely:</strong> Run user code with <code>globalOutbound: null</code> (no network)</li> <li><strong>Return result:</strong> Send back JSON response</li></ol></div> <div><h2 class="text-2xl font-bold font-mono mb-4">SECURITY</h2> <ul class="list-disc ml-6 space-y-1"><li><strong>Network isolation:</strong> <code>globalOutbound: null</code> blocks all external requests</li> <li><strong>Memory limits:</strong> 128MB per Worker isolate</li> <li><strong>CPU limits:</strong> 50ms execution time</li> <li><strong>Sandboxed execution:</strong> Complete V8 isolate per user code</li></ul></div> <div><h2 class="text-2xl font-bold font-mono mb-4">USE CASES</h2> <ul class="list-disc ml-6 space-y-1"><li>Code playgrounds and educational platforms</li> <li>User-defined data transformations</li> <li>Custom business logic execution</li> <li>Serverless function-as-a-service</li></ul></div> <div class="border-t-2 border-black pt-6"><h3 class="text-xl font-bold font-mono mb-2">Related patterns</h3> <ul class="list-disc ml-6"><li><a class="underline" href="/fleet-pattern">Fleet Pattern: Hierarchical Durable Objects</a></li> <li><a class="underline" href="/userdo">UserDO: Per-user Durable Objects</a></li> <li><a class="underline" href="/blaze">Blaze: Real-time JSON documents</a></li></ul></div></div></section><!----><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_seuxg2 = {
						base: new URL(".", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("./_app/immutable/entry/start.B6XN_71n.js"),
						import("./_app/immutable/entry/app.BC487iTC.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 15],
							data: [{type:"data",data:{user:null,session:null},uses:{}},{type:"data",data:{code:{wranglerConfig:"{\n  \"name\": \"promptlog\",\n  \"main\": \"src/index.ts\",\n  \"compatibility_date\": \"2024-01-15\",\n  \"experimental\": {\n    \"worker_loader\": true\n  }\n}",mainWorker:"import { Hono } from 'hono';\n\nconst app = new Hono();\n\n// Submit user code and get execution hash\napp.post('/submit', async (c) => {\n  const { code } = await c.req.json();\n\n  // Hash the code to create unique worker ID\n  const hash = await hashCode(code);\n\n  // Create dynamic worker from user code\n  await createDynamicWorker(hash, code, c.env);\n\n  return c.json({ hash, url: `/run/${hash}` });\n});\n\n// Execute the user's code\napp.get('/run/:hash', async (c) => {\n  const hash = c.req.param('hash');\n  const prompt = c.req.query('prompt') || '';\n\n  // Get the dynamic worker and run it\n  const worker = c.env.WORKER_LOADER.get(hash);\n  const response = await worker.fetch(\n    new Request(`https://dummy/?prompt=${encodeURIComponent(prompt)}`)\n  );\n\n  return response;\n});\n\nasync function hashCode(code: string): Promise\u003Cstring> {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(code);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').slice(0, 8);\n}\n\nexport default app;",dynamicWorker:"async function createDynamicWorker(hash: string, userCode: string, env: any) {\n  // Wrap user code in a secure worker template\n  const workerCode = `\n    export default {\n      async fetch(request) {\n        const url = new URL(request.url);\n        const prompt = url.searchParams.get('prompt') || '';\n\n        try {\n          // Execute user code\n          ${userCode}\n\n          // Return the result\n          return new Response(JSON.stringify(result), {\n            headers: { 'content-type': 'application/json' }\n          });\n        } catch (error) {\n          return new Response(JSON.stringify({\n            error: error.message\n          }), {\n            status: 500,\n            headers: { 'content-type': 'application/json' }\n          });\n        }\n      }\n    };\n  `;\n\n  // Create the worker with network isolation\n  await env.WORKER_LOADER.put(hash, workerCode, {\n    globalOutbound: null  // No network access\n  });\n}",userCode:"// User submits this JavaScript:\n\nconst words = prompt.split(' ');\nconst reversed = words.reverse().join(' ');\n\nconst result = {\n  original: prompt,\n  reversed: reversed,\n  wordCount: words.length,\n  timestamp: new Date().toISOString()\n};\n\n// The wrapper will return this as JSON"}},uses:{}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
